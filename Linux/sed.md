# 基本操作之sed

## sed介绍
sed 全名为 stream editor，流编辑器，用程序的方式来编辑文本，功能相当的强大。是贝尔实验室的 Lee E.McMahon 在 1973 年到 1974 年之间开发完成，目前可以在大多数操作系统中使用，sed 的出现作为 grep 的继任者。与vim等编辑器不同，sed 是一种非交互式编辑器(即用户不必参与编辑过程)，它使用预先设定好的编辑指令对输入的文本进行编辑，完成之后再输出编辑结构。sed 基本上就是在玩正则模式匹配，

## sed工作原理
sed会一次处理一行内容。处理时，把当前处理的行存储在临时缓冲区中，成为"模式空间"（pattern space），接着用sed命令处理缓冲区中的内容，处理完成后，把缓冲区的内容送往屏幕。接着处理下一行，这样不断重复，直到文件末尾。文件内容并没有改变，除非你使用重定向存储输出。

+ 选项
+ e Expression，指定多个编辑命令
+  File，指定sed 命令脚本文件
+ n 阻止输入行自动输出（只有经过sed 处理过的行才显示出
来，其他不显示）


## sed在文件中定位文本的方式
匹配 | 说明
:--: | :--:
n  | 第n 行
$  | 最后一行
m,n  | 从第m 行到第n 行
/pattern/  | 包含指定模式的行
/pattern/,n  | 从包含指定模式的行到第n 行
n,/pattern/  | 从第n 行到包含指定模式的行
/pattern1/,/pattern2/  | 从包含模式1 的行到包含模式2 的行
!  | 反向选择，不包含指定行，如m,n!


## 常用子命令
### 子命令速记
子命令 | 助记 | 说明
:--: | :--: | :--:
p  | Print  | 打印匹配行
= |  —  | 显示匹配行的行号
d  | Delete  | 删除匹配行
a\  | Append  | 在指定行后面追加文本
i\  | Insert  | 在指定行后面插入文本
c\  | Correct  | 用新文本替换指定行
s  | Substitute  | 替换命令
l  | List  | 显示指定行中的所有字符
r  | Read  | 读取文件
w  | Write  | 写入文件
n  | Next  | 读取指定行的下一行
q  | Quit  | 退出sed

### 子命令详解
+ 1、子命令a
子命令a表示在指定行下边插入指定行的内容。
```bash
# 将message文件中每一行下边都插入添加一行内容是A
sed ‘a A’ message

# 将message文件中1-2行的下边插入添加一行内容是A
sed ‘1,2a A’ message

# 将message文件中1-2行的下边分别添加3行，3行内容分别是A、B、C，这里使用了\n，插入多行内容都可以按照这种方式来实现。
sed ‘1,2a A\nB\nC’ message
```
+ 2、子命令i
子命令i和a使用上基本上一样，只不过是在指定行上边插入指定行的内容。
```bash
sed ‘i A’ message
# 将message文件中每一行上边都插入添加一行内容是A。

sed ‘1,2i A’ message
# 将message文件中1-2行的上边插入添加一行内容是A

sed ‘1,2i A\nB\nC’ message
# 将message文件中1-2行的上边分别添加3行，3行内容分别是A、B、C，这里使用了\n，插入多行内容都可以按照这种方式来实现。
```
3、子命令c
子命令c是表示把指定的行内容替换为自己需要的行内容。
```bash
sed ‘c A’ message
# 将message文件中所有的行内容都分别替换为A行内容。

sed ‘1,2c A’ message
# 将message文件中1-2行的内容替换为A，注意这里说的是将1-2行所有的内容只替换为一个A内容，也就是1-2行内容编程了一行，定址如果连续就是这种情况。如果想把1-2行分别替换为A，可以参考下个例子的方式。

sed ‘1,2c A\nA’ message
# 将message中1-2行内容分别替换为了A，需要在替换内容上手动加换行\n，这样当然也可以将一行内容替换为多行内容。
```
4、子命令d
子命令d表示删除指定的行内容，比较简单，更容易理解。
```bah
sed ‘d’ message
# 将message所有行全部删除，因为没有加定址表达式，所以平时如果需要删除指定行内容，需要在子命令前加定址表达式。

sed ‘1,3d’ message
# 将message文件中1-3行内容删除。
```
5、子命令y
子命令y表示字符替换，可以替换多个字符，只能替换字符不能替换字符串，且不支持正则表达式，具体使用方法看例子。
```bash
sed ‘y/ab/AB/’ message
# 把message中所有a字符替换为A符号，所有b字符替换为B符号。
# 强调一下，这里的替换源字符个数和目的字符个数必须相等；字符不支持正则表达式；源字符和目标字符每个字符需要一一对应。
```
6、子命令=

子命令=，可以将行号打印出来。
```bash
sed ‘1,2=’ message
结果：

1
nihao
2
hello world
# 将指定行的上边显示行号。
```
7、子命令r
子命令r，类似于a，也是将内容追加到指定行的后边，只不过r是将指定文件内容读取并追加到指定行下边。 
```bash
sed ‘2r a.txt’ message
# 将a.txt文件内容读取并插入到message文件第2行的下边。
```
8、子命令s

子命令s为替换子命令，是平时sed使用的最多的子命令，没有之一。因为支持正则表达式，功能变得强大无比，下边来详细地说说子命令s的使用方法。
```bash
基本语法：
[address]s/pattern/replacement/flags

s字符串替换，替换的时候可以把/换成其它的符号，比如=，replacement部分用下列字符会有特殊含义：

&：用正则表达式匹配的内容进行替换
\n：回调参数
\(\)：保存被匹配的字符以备反向引用\n时使用，最多9个标签，标签书序从左到右

Flags
n：可以是1-512，表示第n次出现的情况进行替换
g：全局更改
p：打印模式空间的内容
w file：写入到一个文件file中

实例用法

测试文件：

# cat message
hello 123 world

sed ‘s/hello/HELLO/’ message
# 将message每行包含的第一个hello的字符串替换为HELLO，这是最基本的用法。

sed -r ‘s/[a-z]+ [0-9]+ [a-z]+/A/’ message
结果：A
# 使用了扩展正则表达式，需要加-r选项。

sed -r ‘s/([a-z]+)( [0-9]+ )([a-z]+)/\1\2\3/’ message
结果：hello 123 world
# 再看下一个例子就明白了。

sed -r ‘s/([a-z]+)( [0-9]+ )([a-z]+)/\3\2\1/’ message
结果：world 123 hello
# \1表示正则第一个分组结果，\2表示正则匹配第二个分组结果，\3表示正则匹配第三个分组结果。

sed -r ‘s/([a-z]+)( [0-9]+ )([a-z]+)/&/’ message
结果：hello 123 world
# &表示正则表达式匹配的整个结果集。

sed -r ‘s/([a-z]+)( [0-9]+ )([a-z]+)/111&222/’ message
结果：111hello 123 world222
# 在匹配结果前后分别加了111、222。

sed -r ‘s/.*/111&222/’ message
# 在message文件中每行的首尾分别加上111、222。

sed ‘s/i/A/g’ message
# 把message文件中每行的所有i字符替换为A，默认不加g标记时只替换每行的第一个字符。

sed ‘s/i/A/2’ message
# 把message文件中每行的第2个i字符替换为A。

sed -n ‘s/i/A/p’ message
# 加-p标记会把被替换的行打印出来，再加上-n选项会关闭模式空间打印模式，因此该命令的效果就是只显示被替换修改的行。

sed -n ‘s/i/A/w b.txt’ message
# 把message文件中内容的每行第一个字符i替换为A，然后把修改内容另存为b.txt文件。

sed -n ‘s/i/A/i’ message
# 把message文件中每一行的第一个i或I字符替换为A字符，也即是忽略大小写。
```


+ [awk-sed](https://github.com/renchunxiao/awk-sed/wiki)
